@model MerkaCentro.Application.DTOs.ProductDto
@{
    ViewData["Title"] = Model?.Name ?? "Detalle de Producto";
    var stockClass = Model?.CurrentStock <= 0 ? "stock-danger" :
                     Model?.CurrentStock <= Model?.MinStock ? "stock-warning" : "stock-ok";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="page-title mb-0">
        <i class="bi bi-box me-2"></i>@Model?.Name
    </h1>
    <div>
        <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-primary">
            <i class="bi bi-pencil me-1"></i>Editar
        </a>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Volver
        </a>
    </div>
</div>

@if (Model != null)
{
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-info-circle me-2"></i>Informacion del Producto
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <dl>
                                <dt>Codigo</dt>
                                <dd><code class="fs-5">@Model.Code</code></dd>

                                <dt>Codigo de Barras</dt>
                                <dd>@(Model.Barcode ?? "-")</dd>

                                <dt>Categoria</dt>
                                <dd>@Model.CategoryName</dd>

                                <dt>Unidad de Medida</dt>
                                <dd>@Model.Unit</dd>
                            </dl>
                        </div>
                        <div class="col-md-6">
                            <dl>
                                <dt>Precio de Compra</dt>
                                <dd class="price-purchase fs-5">S/ @Model.PurchasePrice.ToString("N2")</dd>

                                <dt>Precio de Venta</dt>
                                <dd class="price fs-4">S/ @Model.SalePrice.ToString("N2")</dd>

                                <dt>Margen de Ganancia</dt>
                                <dd>
                                    @{
                                        var margin = Model.PurchasePrice > 0
                                            ? ((Model.SalePrice - Model.PurchasePrice) / Model.PurchasePrice) * 100
                                            : 0;
                                    }
                                    <span class="badge bg-success">@margin.ToString("N1")%</span>
                                </dd>
                            </dl>
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <hr />
                        <dt>Descripcion</dt>
                        <dd>@Model.Description</dd>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-boxes me-2"></i>Stock
                </div>
                <div class="card-body text-center">
                    <div class="@stockClass display-4 fw-bold mb-2">
                        @Model.CurrentStock.ToString("N2")
                    </div>
                    <div class="text-muted">@Model.Unit</div>
                    <hr />
                    <div class="text-muted small">
                        Stock Minimo: <strong>@Model.MinStock.ToString("N2")</strong>
                    </div>
                    @if (Model.CurrentStock <= Model.MinStock)
                    {
                        <div class="alert alert-warning mt-3 mb-0">
                            <i class="bi bi-exclamation-triangle me-1"></i>
                            Stock bajo. Reabastecer pronto.
                        </div>
                    }
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="bi bi-arrow-down-up me-2"></i>Ajustar Stock
                </div>
                <div class="card-body">
                    <form asp-action="UpdateStock" asp-route-id="@Model.Id" method="post">
                        <div class="mb-3">
                            <label class="form-label">Cantidad</label>
                            <input type="number" name="quantity" class="form-control" step="0.001"
                                   placeholder="+ agregar, - quitar" required />
                            <small class="text-muted">Use valores negativos para quitar stock</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Razon</label>
                            <select name="reason" class="form-select" required>
                                <option value="">-- Seleccione --</option>
                                <option value="Compra">Compra</option>
                                <option value="Ajuste de inventario">Ajuste de inventario</option>
                                <option value="Devolucion">Devolucion</option>
                                <option value="Merma">Merma</option>
                                <option value="Vencimiento">Vencimiento</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-warning w-100">
                            <i class="bi bi-arrow-repeat me-1"></i>Actualizar Stock
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}
